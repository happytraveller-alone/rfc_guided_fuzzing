//----- (00000001400BA4BC) ----------------------------------------------------
__int64 __fastcall rollBackFailedUpdateFromDs(__int64 a1, __int64 a2, __int64 a3)
{
  CDnsClientSubnetRecordsTrie *v6; // rcx
  __int64 i; // rbx
  __int64 v8; // rdi

  v6 = WPP_GLOBAL_Control;
  if ( WPP_GLOBAL_Control != (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
    && (*((_DWORD *)WPP_GLOBAL_Control + 17) & 0x80000) != 0
    && *((_BYTE *)WPP_GLOBAL_Control + 65) >= 4u )
  {
    WPP_SF_(*((_QWORD *)WPP_GLOBAL_Control + 7), 0x8Bu, (__int64)&WPP_40fcce62f6f439b0ec75be29cae6130a_Traceguids);
    v6 = WPP_GLOBAL_Control;
  }
  for ( i = *(_QWORD *)(a2 + 16); i && i != *(_QWORD *)(a2 + 24); i = *(_QWORD *)(i + 24) )
  {
    if ( *(_DWORD *)(i + 84) == -2004352768 )
    {
      if ( v6 != (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
        && (*((_DWORD *)v6 + 17) & 0x80000) != 0
        && *((_BYTE *)v6 + 65) >= 4u )
      {
        WPP_SF_q(*((_QWORD *)v6 + 7), 0x8Cu, (__int64)&WPP_40fcce62f6f439b0ec75be29cae6130a_Traceguids, i);
LABEL_21:
        v6 = WPP_GLOBAL_Control;
        continue;
      }
    }
    else
    {
      v8 = *(_QWORD *)(i + 8);
      *(_DWORD *)(i + 84) = -2004352768;
      if ( WPP_GLOBAL_Control != (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
        && (*((_DWORD *)WPP_GLOBAL_Control + 17) & 0x80000) != 0
        && *((_BYTE *)WPP_GLOBAL_Control + 65) >= 4u )
      {
        WPP_SF_qq(
          *((_QWORD *)WPP_GLOBAL_Control + 7),
          0x8Du,
          (__int64)&WPP_40fcce62f6f439b0ec75be29cae6130a_Traceguids,
          i,
          v8);
      }
      if ( !(unsigned int)Ds_WriteNodeToDs(a1, v8, 0xFFu, 2, a3, 0) )
        goto LABEL_21;
      v6 = WPP_GLOBAL_Control;
      if ( WPP_GLOBAL_Control != (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
        && (*((_DWORD *)WPP_GLOBAL_Control + 17) & 0x80000) != 0
        && *((_BYTE *)WPP_GLOBAL_Control + 65) >= 2u )
      {
        WPP_SF_sq(
          *((_QWORD *)WPP_GLOBAL_Control + 7),
          0x8Eu,
          (__int64)&WPP_40fcce62f6f439b0ec75be29cae6130a_Traceguids,
          (const char *)(v8 + 102));
        goto LABEL_21;
      }
    }
  }
  return 0i64;
}
