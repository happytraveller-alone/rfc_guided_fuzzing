//----- (000000014007868C) ----------------------------------------------------
HKEY __fastcall Reg_OpenPolicy(HKEY hKey, const WCHAR *a2, const unsigned __int16 *a3, int a4)
{
  int v4; // edi
  HKEY v7; // rbx
  HKEY phkResult; // [rsp+50h] [rbp-18h] BYREF
  int v10; // [rsp+80h] [rbp+18h] BYREF

  phkResult = 0i64;
  v4 = 0;
  v10 = 0;
  v7 = hKey;
  if ( !a3 )
  {
    if ( WPP_GLOBAL_Control != (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
      && (*((_BYTE *)WPP_GLOBAL_Control + 68) & 2) != 0
      && *((_BYTE *)WPP_GLOBAL_Control + 65) >= 2u )
    {
      WPP_SF_(*((_QWORD *)WPP_GLOBAL_Control + 7), 0x87u, (__int64)&WPP_6ba06e9d807b3b6640892c588bf1aced_Traceguids);
    }
    return 0i64;
  }
  if ( !hKey )
  {
    v4 = 1;
    if ( a4 == 1 )
    {
      v7 = OpenZonePolicies(0i64, 0, a2, &v10);
      if ( !v7 )
      {
        if ( WPP_GLOBAL_Control != (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
          && (*((_BYTE *)WPP_GLOBAL_Control + 68) & 2) != 0
          && *((_BYTE *)WPP_GLOBAL_Control + 65) >= 2u )
        {
          WPP_SF_SD(
            *((_QWORD *)WPP_GLOBAL_Control + 7),
            0x88u,
            (__int64)&WPP_6ba06e9d807b3b6640892c588bf1aced_Traceguids,
            a2);
        }
        return 0i64;
      }
    }
    else if ( !a4 )
    {
      v7 = OpenServerPolicies(0, &v10);
      if ( !v7 )
      {
        if ( WPP_GLOBAL_Control != (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
          && (*((_BYTE *)WPP_GLOBAL_Control + 68) & 2) != 0
          && *((_BYTE *)WPP_GLOBAL_Control + 65) >= 2u )
        {
          WPP_SF_D(
            *((_QWORD *)WPP_GLOBAL_Control + 7),
            0x89u,
            (__int64)&WPP_6ba06e9d807b3b6640892c588bf1aced_Traceguids,
            v10);
        }
        return 0i64;
      }
    }
  }
  if ( RegCreateKeyExW(v7, a3, 0, (LPWSTR)L"DnsRegistryClass", 0, 0x2001Fu, 0i64, &phkResult, 0i64)
    && WPP_GLOBAL_Control != (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
    && (*((_BYTE *)WPP_GLOBAL_Control + 68) & 2) != 0
    && *((_BYTE *)WPP_GLOBAL_Control + 65) >= 2u )
  {
    WPP_SF_SD(*((_QWORD *)WPP_GLOBAL_Control + 7), 0x8Au, (__int64)&WPP_6ba06e9d807b3b6640892c588bf1aced_Traceguids, a3);
  }
  if ( v4 )
    RegCloseKey(v7);
  return phkResult;
}
