//----- (00000001400A7AC0) ----------------------------------------------------
__int64 __fastcall Rpc_ClearCache(__int64 a1, __int64 a2, __int64 a3, __int64 a4, PCNZWCH lpString1)
{
  CDnsClientSubnetRecordsTrie *v5; // r10
  __int64 v6; // rax
  unsigned int v7; // ebx
  __int64 v8; // r8
  unsigned __int16 *v9; // rdi
  unsigned int RootHints; // eax
  __int64 v11; // rdx
  __int64 v12; // rcx
  const unsigned __int16 *v13; // r9
  __int64 v14; // rax
  const unsigned __int16 *v15; // rsi
  unsigned __int16 *v16; // rcx
  unsigned __int16 *v18[2]; // [rsp+40h] [rbp-28h] BYREF
  __int128 v19; // [rsp+50h] [rbp-18h] BYREF

  v18[0] = 0i64;
  v5 = WPP_GLOBAL_Control;
  if ( WPP_GLOBAL_Control != (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
    && (*((_BYTE *)WPP_GLOBAL_Control + 68) & 4) != 0
    && *((_BYTE *)WPP_GLOBAL_Control + 65) >= 4u )
  {
    WPP_SF_(*((_QWORD *)WPP_GLOBAL_Control + 7), 0x14u, (__int64)&WPP_8dcaf0ee02573174dfb45ec0cfad4f2e_Traceguids);
    v5 = WPP_GLOBAL_Control;
  }
  v6 = g_pCacheZone;
  if ( !g_pCacheZone )
  {
    v7 = 9607;
    goto LABEL_59;
  }
  if ( !lpString1 )
    goto LABEL_22;
  if ( !(unsigned int)wcsicmp_ThatWorks(lpString1, L"..Cache") )
  {
    v5 = WPP_GLOBAL_Control;
    v6 = g_pCacheZone;
LABEL_22:
    v9 = (unsigned __int16 *)v6;
LABEL_23:
    if ( *((_QWORD *)v9 + 9) )
    {
      v7 = *((_QWORD *)v9 + 24) != 0i64 ? 9962 : 9607;
      goto LABEL_59;
    }
    if ( v9 == (unsigned __int16 *)v6 )
    {
      if ( v5 != (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
        && (*((_BYTE *)v5 + 68) & 4) != 0
        && *((_BYTE *)v5 + 65) >= 4u )
      {
        WPP_SF_(*((_QWORD *)v5 + 7), 0x17u, (__int64)&WPP_8dcaf0ee02573174dfb45ec0cfad4f2e_Traceguids);
      }
      Zone_WriteBackRootHints(0);
    }
    if ( (unsigned int)Zone_LockForWriteEx((__int64)v9, 1, 0x2710u, (__int64)"ds\\dns\\server\\server\\srvrpc.c", 138) )
    {
      v7 = *((_QWORD *)v9 + 24) != 0i64 ? 9962 : 9607;
    }
    else
    {
      if ( *((_QWORD *)v9 + 24) )
        RootHints = ZoneScope_LoadRootHints((__int64)v9);
      else
        RootHints = Zone_LoadRootHints();
      v7 = RootHints;
      if ( RootHints )
      {
        v5 = WPP_GLOBAL_Control;
        if ( WPP_GLOBAL_Control == (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control )
          return v7;
        if ( (*((_BYTE *)WPP_GLOBAL_Control + 68) & 4) == 0 || *((_BYTE *)WPP_GLOBAL_Control + 65) < 4u )
          goto LABEL_59;
        v13 = L"Default";
        if ( *((_QWORD *)v9 + 24) )
          v13 = (const unsigned __int16 *)*((_QWORD *)v9 + 24);
        WPP_SF_S(
          *((_QWORD *)WPP_GLOBAL_Control + 7),
          0x18u,
          (__int64)&WPP_8dcaf0ee02573174dfb45ec0cfad4f2e_Traceguids,
          v13);
      }
      else
      {
        v14 = g_pzoneRemoteGlobalNames;
        if ( g_pzoneRemoteGlobalNames && !*((_QWORD *)v9 + 24) )
        {
          if ( WPP_GLOBAL_Control != (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
            && (*((_BYTE *)WPP_GLOBAL_Control + 68) & 4) != 0
            && *((_BYTE *)WPP_GLOBAL_Control + 65) >= 4u )
          {
            WPP_SF_q(
              *((_QWORD *)WPP_GLOBAL_Control + 7),
              0x19u,
              (__int64)&WPP_8dcaf0ee02573174dfb45ec0cfad4f2e_Traceguids,
              g_pzoneRemoteGlobalNames);
            v14 = g_pzoneRemoteGlobalNames;
          }
          g_pnodeGnzService = 0i64;
          Zone_DumpData(v14);
          Gnz_TimeoutTasks(1);
        }
        v15 = L"Default";
        if ( dword_1401B991C )
        {
          v16 = L"Default";
          if ( *((_QWORD *)v9 + 24) )
            v16 = (unsigned __int16 *)*((_QWORD *)v9 + 24);
          v18[0] = v16;
          v19 = DNS_EVENT_CACHESCOPE_FLUSHED;
          Eventlog_LogEvent((__int64)&v19, v11, 1u, v18, (unsigned __int8 *)1, 0, 0, 0i64);
        }
        if ( (dword_1401B9104 & 0x20) != 0 )
        {
          if ( *((_QWORD *)v9 + 24) )
            v15 = (const unsigned __int16 *)*((_QWORD *)v9 + 24);
          Template_qsz(v12, v11, 255, "*", v15);
        }
      }
    }
LABEL_58:
    v5 = WPP_GLOBAL_Control;
    goto LABEL_59;
  }
  v7 = LookUp_ScopeMap(*(_QWORD *)(g_pCacheZone + 160), *(_QWORD *)(g_pCacheZone + 168), v8, 0x2710u, lpString1, v18);
  if ( !v7 )
  {
    v9 = v18[0];
    if ( !v18[0] )
    {
      v5 = WPP_GLOBAL_Control;
      if ( WPP_GLOBAL_Control != (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
        && (*((_BYTE *)WPP_GLOBAL_Control + 68) & 0x10) != 0
        && *((_BYTE *)WPP_GLOBAL_Control + 65) >= 2u )
      {
        WPP_SF_S(
          *((_QWORD *)WPP_GLOBAL_Control + 7),
          LOWORD(v18[0]) + 22,
          (__int64)&WPP_8dcaf0ee02573174dfb45ec0cfad4f2e_Traceguids,
          lpString1);
        v5 = WPP_GLOBAL_Control;
      }
      v7 = 9952;
      goto LABEL_59;
    }
    v5 = WPP_GLOBAL_Control;
    v6 = g_pCacheZone;
    goto LABEL_23;
  }
  v5 = WPP_GLOBAL_Control;
  if ( WPP_GLOBAL_Control == (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control )
    return v7;
  if ( (*((_BYTE *)WPP_GLOBAL_Control + 68) & 0x10) != 0 && *((_BYTE *)WPP_GLOBAL_Control + 65) >= 2u )
  {
    WPP_SF_SD(
      *((_QWORD *)WPP_GLOBAL_Control + 7),
      0x15u,
      (__int64)&WPP_8dcaf0ee02573174dfb45ec0cfad4f2e_Traceguids,
      lpString1);
    goto LABEL_58;
  }
LABEL_59:
  if ( v5 != (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
    && (*((_BYTE *)v5 + 68) & 4) != 0
    && *((_BYTE *)v5 + 65) >= 4u )
  {
    WPP_SF_D(*((_QWORD *)v5 + 7), 0x1Au, (__int64)&WPP_8dcaf0ee02573174dfb45ec0cfad4f2e_Traceguids, v7);
  }
  return v7;
}
// 1400A7B86: variable 'v8' is possibly undefined
// 1400A7E00: variable 'v11' is possibly undefined
// 1400A7E2E: variable 'v12' is possibly undefined
// 1401871B0: using guessed type __int128 DNS_EVENT_CACHESCOPE_FLUSHED;
// 140188260: using guessed type wchar_t aDefault_1[8];
// 1401B8EF0: using guessed type __int64 g_pzoneRemoteGlobalNames;
// 1401B8F08: using guessed type __int64 g_pnodeGnzService;
// 1401B9104: using guessed type int dword_1401B9104;
// 1401B991C: using guessed type int dword_1401B991C;
// 1401EC628: using guessed type __int64 g_pCacheZone;
