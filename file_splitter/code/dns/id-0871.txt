//----- (0000000140077DFC) ----------------------------------------------------
__int64 __fastcall Reg_AddVirtualizationInstance(__int64 a1, int a2)
{
  unsigned int v4; // ebx
  HKEY v5; // rax
  HKEY v6; // r15
  CDnsClientSubnetRecordsTrie *v7; // rcx
  unsigned __int16 v8; // dx
  CDnsClientSubnetRecordsTrie *v9; // rcx
  unsigned __int16 v10; // dx
  BYTE *v11; // rcx
  __int64 v12; // rbp
  __int64 v13; // rax
  BYTE *v14; // rdx

  v4 = 0;
  v5 = Reg_OpenVirtualizationInstance(0i64, *(LPCWSTR *)(a1 + 16));
  v6 = v5;
  if ( v5 )
  {
    if ( !a2 )
      goto LABEL_24;
    if ( (*(_BYTE *)(a1 + 8) & 2) != 0 )
    {
      v4 = Reg_DeleteValue(0, v5, 0i64, "FriendlyName");
      if ( v4 == 2 )
        v4 = 0;
      if ( v4 )
      {
        v7 = WPP_GLOBAL_Control;
        if ( WPP_GLOBAL_Control == (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
          || (*((_BYTE *)WPP_GLOBAL_Control + 68) & 2) == 0
          || *((_BYTE *)WPP_GLOBAL_Control + 65) < 4u )
        {
          goto LABEL_44;
        }
        v8 = 116;
        goto LABEL_15;
      }
    }
    if ( (*(_BYTE *)(a1 + 8) & 4) == 0 )
      goto LABEL_24;
    v4 = Reg_DeleteValue(0, v6, 0i64, "Description");
    if ( v4 == 2 )
      v4 = 0;
    if ( v4 )
    {
      v9 = WPP_GLOBAL_Control;
      if ( WPP_GLOBAL_Control == (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
        || (*((_BYTE *)WPP_GLOBAL_Control + 68) & 2) == 0
        || *((_BYTE *)WPP_GLOBAL_Control + 65) < 4u )
      {
        goto LABEL_44;
      }
      v10 = 117;
    }
    else
    {
LABEL_24:
      v11 = *(BYTE **)(a1 + 24);
      v12 = -1i64;
      if ( v11 && ((*(_BYTE *)(a1 + 8) & 2) != 0 || !a2) )
      {
        v13 = -1i64;
        do
          ++v13;
        while ( *(_WORD *)&v11[2 * v13] );
        v4 = Reg_SetValue(0x10000000, v6, 0i64, (const CHAR *)L"FriendlyName", 0xF0000001, v11, 2 * (int)v13 + 2);
        if ( v4 )
        {
          v7 = WPP_GLOBAL_Control;
          if ( WPP_GLOBAL_Control == (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
            || (*((_BYTE *)WPP_GLOBAL_Control + 68) & 2) == 0
            || *((_BYTE *)WPP_GLOBAL_Control + 65) < 4u )
          {
            goto LABEL_44;
          }
          v8 = 118;
LABEL_15:
          WPP_SF_Ds(
            *((_QWORD *)v7 + 7),
            v8,
            (__int64)&WPP_6ba06e9d807b3b6640892c588bf1aced_Traceguids,
            v4,
            (__int64)L"FriendlyName");
LABEL_44:
          RegCloseKey(v6);
          return v4;
        }
      }
      v14 = *(BYTE **)(a1 + 32);
      if ( !v14 || (*(_BYTE *)(a1 + 8) & 4) == 0 && a2 )
        goto LABEL_44;
      do
        ++v12;
      while ( *(_WORD *)&v14[2 * v12] );
      v4 = Reg_SetValue(0x10000000, v6, 0i64, (const CHAR *)L"Description", 0xF0000001, v14, 2 * (int)v12 + 2);
      if ( !v4 )
        goto LABEL_44;
      v9 = WPP_GLOBAL_Control;
      if ( WPP_GLOBAL_Control == (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
        || (*((_BYTE *)WPP_GLOBAL_Control + 68) & 2) == 0
        || *((_BYTE *)WPP_GLOBAL_Control + 65) < 4u )
      {
        goto LABEL_44;
      }
      v10 = 119;
    }
    WPP_SF_Ds(
      *((_QWORD *)v9 + 7),
      v10,
      (__int64)&WPP_6ba06e9d807b3b6640892c588bf1aced_Traceguids,
      v4,
      (__int64)L"Description");
    goto LABEL_44;
  }
  v4 = 1011;
  if ( WPP_GLOBAL_Control != (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
    && (*((_BYTE *)WPP_GLOBAL_Control + 68) & 2) != 0
    && *((_BYTE *)WPP_GLOBAL_Control + 65) >= 2u )
  {
    WPP_SF_S(
      *((_QWORD *)WPP_GLOBAL_Control + 7),
      0x73u,
      (__int64)&WPP_6ba06e9d807b3b6640892c588bf1aced_Traceguids,
      *(const unsigned __int16 **)(a1 + 16));
  }
  return v4;
}
// 1401883B8: using guessed type wchar_t aFriendlyname_0[13];
// 1401883D8: using guessed type wchar_t aDescription[12];
