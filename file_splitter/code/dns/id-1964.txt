//----- (00000001400F20AC) ----------------------------------------------------
void __fastcall DnsOls_CleanupForZoneDeletion(struct _zone_info *a1, char a2)
{
  CDnsClientSubnetRecordsTrie *v4; // rcx
  const char *v5; // r9
  struct _dnsskd *v6; // rdi
  unsigned __int16 **v7; // rsi
  __int64 v8; // rbp

  v4 = WPP_GLOBAL_Control;
  if ( WPP_GLOBAL_Control != (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
    && (*((_DWORD *)WPP_GLOBAL_Control + 17) & 0x200000) != 0
    && *((_BYTE *)WPP_GLOBAL_Control + 65) >= 4u )
  {
    if ( a1 )
      v5 = (const char *)*((_QWORD *)a1 + 2);
    else
      v5 = 0i64;
    WPP_SF_s(*((_QWORD *)WPP_GLOBAL_Control + 7), 0xADu, (__int64)&WPP_4a0a7bf065bf32df4bbeec8f9c7ea0c3_Traceguids, v5);
    v4 = WPP_GLOBAL_Control;
  }
  if ( a1 && *((_DWORD *)a1 + 93) == 1 )
  {
    if ( ((*((_DWORD *)a1 + 260) & 2) != 0 || (*((_BYTE *)a1 + 388) & 1) == 0) && (*((_DWORD *)a1 + 260) & 0x1C0) == 64 )
    {
      DnsOls_PublishOrRemoveKeyAsTrustAnchor((__int64)a1, 0i64, 0i64, 0);
      v4 = WPP_GLOBAL_Control;
    }
    if ( (*((_BYTE *)a1 + 1040) & 2) != 0 )
    {
      if ( v4 != (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
        && (*((_DWORD *)v4 + 17) & 0x200000) != 0
        && *((_BYTE *)v4 + 65) >= 4u )
      {
        WPP_SF_s(
          *((_QWORD *)v4 + 7),
          0xABu,
          (__int64)&WPP_4a0a7bf065bf32df4bbeec8f9c7ea0c3_Traceguids,
          *((const char **)a1 + 2));
        v4 = WPP_GLOBAL_Control;
      }
      v6 = (struct _dnsskd *)*((_QWORD *)a1 + 142);
      if ( v6 )
      {
        do
        {
          v7 = (unsigned __int16 **)((char *)v6 + 144);
          v8 = 3i64;
          do
          {
            DnsOls_DeleteCertAndKey(a1, v6, *v7);
            Mem_Free(*v7, 0i64, 0i64, (__int64)"ds\\dns\\server\\server\\olscore.cpp", 6259);
            *v7 = 0i64;
            v7 += 3;
            --v8;
          }
          while ( v8 );
          v6 = *(struct _dnsskd **)v6;
        }
        while ( v6 );
        v4 = WPP_GLOBAL_Control;
      }
      if ( v4 != (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
        && (*((_DWORD *)v4 + 17) & 0x200000) != 0
        && *((_BYTE *)v4 + 65) >= 4u )
      {
        WPP_SF_s(
          *((_QWORD *)v4 + 7),
          0xACu,
          (__int64)&WPP_4a0a7bf065bf32df4bbeec8f9c7ea0c3_Traceguids,
          *((const char **)a1 + 2));
      }
      if ( (*((_BYTE *)a1 + 388) & 1) != 0 )
        DnsOls_RemoveKeymasterAttributesForZone((__int64)a1, a2);
    }
  }
}
