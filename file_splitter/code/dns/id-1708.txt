//----- (00000001400DA5E0) ----------------------------------------------------
void __fastcall Xfr_SendSoaQuery(struct _zone_info *a1)
{
  CDnsClientSubnetRecordsTrie *v2; // rcx
  int RodcMasters; // edi
  __int64 SendMessage; // rax
  __int64 v5; // rdi
  int v6; // eax
  int Socket; // esi
  int inserted; // esi
  __int64 v9; // rdx
  int v10; // eax

  v2 = WPP_GLOBAL_Control;
  if ( WPP_GLOBAL_Control != (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
    && (*((_BYTE *)WPP_GLOBAL_Control + 68) & 0x40) != 0
    && *((_BYTE *)WPP_GLOBAL_Control + 65) >= 4u )
  {
    WPP_SF_s(
      *((_QWORD *)WPP_GLOBAL_Control + 7),
      0x33u,
      (__int64)&WPP_8f5c62d9956434feed7ea8f9d17b2299_Traceguids,
      *((const char **)a1 + 2));
    v2 = WPP_GLOBAL_Control;
  }
  if ( *((char *)a1 + 428) < 0 )
  {
    if ( v2 != (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
      && (*((_BYTE *)v2 + 68) & 0x40) != 0
      && *((_BYTE *)v2 + 65) >= 4u )
    {
      WPP_SF_s(
        *((_QWORD *)v2 + 7),
        0x34u,
        (__int64)&WPP_8f5c62d9956434feed7ea8f9d17b2299_Traceguids,
        *((const char **)a1 + 2));
    }
    *((_DWORD *)a1 + 382) = 9607;
    *((_DWORD *)a1 + 381) = 9607;
    *((_DWORD *)a1 + 377) = dword_1401B9714 + 60;
    return;
  }
  if ( (unsigned int)(*((_DWORD *)a1 + 93) - 2) > 1 || dword_1401B9714 <= (unsigned int)(*((_DWORD *)a1 + 376) + 5) )
  {
    if ( v2 != (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
      && (*((_BYTE *)v2 + 68) & 0x40) != 0
      && *((_BYTE *)v2 + 65) >= 4u )
    {
      WPP_SF_sdD(
        *((_QWORD *)v2 + 7),
        0x35u,
        (__int64)&WPP_8f5c62d9956434feed7ea8f9d17b2299_Traceguids,
        *((const char **)a1 + 2));
    }
    v6 = *((_DWORD *)a1 + 382);
    goto LABEL_55;
  }
  RodcMasters = DnsOls_GenerateRodcMasters(a1);
  if ( RodcMasters )
  {
    if ( WPP_GLOBAL_Control != (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
      && (*((_BYTE *)WPP_GLOBAL_Control + 68) & 0x40) != 0
      && *((_BYTE *)WPP_GLOBAL_Control + 65) >= 4u )
    {
      WPP_SF_Ds(
        *((_QWORD *)WPP_GLOBAL_Control + 7),
        0x36u,
        (__int64)&WPP_8f5c62d9956434feed7ea8f9d17b2299_Traceguids,
        RodcMasters,
        *((_QWORD *)a1 + 2));
    }
    *((_DWORD *)a1 + 382) = RodcMasters;
    *((_DWORD *)a1 + 381) = RodcMasters;
    return;
  }
  SendMessage = Msg_CreateSendMessage(0);
  v5 = SendMessage;
  if ( !SendMessage )
  {
    Xfr_RetryZone((__int64)a1);
    v6 = 14;
LABEL_21:
    *((_DWORD *)a1 + 382) = v6;
LABEL_55:
    *((_DWORD *)a1 + 381) = v6;
    return;
  }
  if ( !(unsigned int)Msg_WriteQuestion(SendMessage, *((__int64 **)a1 + 7), 6) )
  {
    if ( WPP_GLOBAL_Control != (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
      && (*((_BYTE *)WPP_GLOBAL_Control + 68) & 0x40) != 0
      && *((_BYTE *)WPP_GLOBAL_Control + 65) >= 4u )
    {
      WPP_SF_s(
        *((_QWORD *)WPP_GLOBAL_Control + 7),
        0x37u,
        (__int64)&WPP_8f5c62d9956434feed7ea8f9d17b2299_Traceguids,
        *((const char **)a1 + 2));
    }
    Packet_Free(v5);
    v6 = 13;
    goto LABEL_21;
  }
  *(_QWORD *)(v5 + 208) = a1;
  *(_QWORD *)(v5 + 6280) = a1;
  if ( dword_1401B99B0 )
    *(_DWORD *)(v5 + 592) |= 2u;
  Socket = Msg_SetRemoteQuerySocket(0i64, v5);
  if ( Socket )
  {
    if ( WPP_GLOBAL_Control != (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
      && (*((_BYTE *)WPP_GLOBAL_Control + 68) & 0x40) != 0
      && *((_BYTE *)WPP_GLOBAL_Control + 65) >= 4u )
    {
      WPP_SF_Ds(
        *((_QWORD *)WPP_GLOBAL_Control + 7),
        0x38u,
        (__int64)&WPP_8f5c62d9956434feed7ea8f9d17b2299_Traceguids,
        Socket,
        *((_QWORD *)a1 + 2));
    }
    *((_DWORD *)a1 + 382) = Socket;
    *((_DWORD *)a1 + 381) = Socket;
    Packet_Free(v5);
  }
  else
  {
    EnterCriticalSection((LPCRITICAL_SECTION)(g_pRemoteQueryQueue + 16));
    inserted = DnsRq_InsertNewRemoteQuery(v5, 2u, 0, (_WORD *)(v5 + 6304), 0i64);
    if ( inserted )
    {
      if ( WPP_GLOBAL_Control != (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
        && (*((_BYTE *)WPP_GLOBAL_Control + 68) & 0x40) != 0
        && *((_BYTE *)WPP_GLOBAL_Control + 65) >= 4u )
      {
        WPP_SF_Ds(
          *((_QWORD *)WPP_GLOBAL_Control + 7),
          0x39u,
          (__int64)&WPP_8f5c62d9956434feed7ea8f9d17b2299_Traceguids,
          inserted,
          *((_QWORD *)a1 + 2));
      }
      *((_DWORD *)a1 + 382) = inserted;
      *((_DWORD *)a1 + 381) = inserted;
      Packet_FreeAttachedMessages(v5);
      Packet_Free(v5);
    }
    else
    {
      if ( *((_DWORD *)a1 + 93) != 3 && (*((_BYTE *)a1 + 1160) & 0x40) == 0 || (v9 = *((_QWORD *)a1 + 147)) == 0 )
        v9 = *((_QWORD *)a1 + 146);
      Send_Multiple(v5, v9, &dword_1401C80AC);
      *((_DWORD *)a1 + 376) = dword_1401B9714;
      v10 = *((_DWORD *)a1 + 381);
      if ( v10 != -1 )
      {
        *((_DWORD *)a1 + 382) = v10;
        *((_DWORD *)a1 + 381) = -1;
      }
      Xfr_RetryZone((__int64)a1);
    }
    LeaveCriticalSection((LPCRITICAL_SECTION)(g_pRemoteQueryQueue + 16));
  }
}
// 1401B9714: using guessed type int dword_1401B9714;
// 1401B99B0: using guessed type int dword_1401B99B0;
// 1401C80AC: using guessed type _DWORD dword_1401C80AC;
// 1401C9538: using guessed type __int64 g_pRemoteQueryQueue;
