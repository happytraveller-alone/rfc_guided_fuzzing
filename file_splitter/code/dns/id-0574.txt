//----- (0000000140052B58) ----------------------------------------------------
__int64 __fastcall File_CreateZoneScopeDirectory(unsigned __int16 *a1, char *a2, int a3, __int64 a4)
{
  unsigned int AbsoluteDatabasePath; // ebx
  bool v8; // zf
  int v9; // eax
  char *v10; // rdx
  DWORD FileAttributesW; // eax
  int LastError; // eax
  unsigned __int16 v14[1560]; // [rsp+30h] [rbp-1CB8h] BYREF
  WCHAR FileName[2080]; // [rsp+C60h] [rbp-1088h] BYREF

  if ( !a1 )
    goto LABEL_20;
  if ( *a1 && _wcsicmp(a1, L".") )
  {
    if ( WPP_GLOBAL_Control != (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
      && (*((_BYTE *)WPP_GLOBAL_Control + 68) & 2) != 0
      && *((_BYTE *)WPP_GLOBAL_Control + 65) >= 4u )
    {
      WPP_SF_S(
        *((_QWORD *)WPP_GLOBAL_Control + 7),
        0x1Bu,
        (__int64)&WPP_10f9086a838d3f1b10076b2179e86fb4_Traceguids,
        a1);
    }
    if ( (int)StringCchCopyW((char *)v14, 1560i64, (char *)L"Virtualization~Instances") < 0
      || (int)StringCchCatW(v14, 1560i64, (char *)L"\\") < 0
      || (int)StringCchCatW(v14, 1560i64, (char *)a1) < 0
      || (int)StringCchCatW(v14, 1560i64, (char *)L"\\") < 0
      || (int)StringCchCatW(v14, 1560i64, a2) < 0 )
    {
      if ( WPP_GLOBAL_Control != (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
        && (*((_BYTE *)WPP_GLOBAL_Control + 68) & 2) != 0
        && *((_BYTE *)WPP_GLOBAL_Control + 65) >= 2u )
      {
        WPP_SF_SS(
          *((_QWORD *)WPP_GLOBAL_Control + 7),
          0x1Cu,
          (__int64)&WPP_10f9086a838d3f1b10076b2179e86fb4_Traceguids,
          a1,
          (__int64)a2);
      }
      return 87;
    }
  }
  if ( !*a1 || (v8 = _wcsicmp(a1, L".") == 0, v9 = 0, v8) )
LABEL_20:
    v9 = 1;
  v10 = (char *)v14;
  if ( v9 )
    v10 = a2;
  AbsoluteDatabasePath = File_CreateAbsoluteDatabasePath(0i64, v10, (char *)FileName, a4, a3);
  if ( AbsoluteDatabasePath )
  {
    if ( WPP_GLOBAL_Control != (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
      && (*((_BYTE *)WPP_GLOBAL_Control + 68) & 2) != 0
      && *((_BYTE *)WPP_GLOBAL_Control + 65) >= 2u )
    {
      WPP_SF_(*((_QWORD *)WPP_GLOBAL_Control + 7), 0x1Du, (__int64)&WPP_10f9086a838d3f1b10076b2179e86fb4_Traceguids);
    }
  }
  else
  {
    FileAttributesW = GetFileAttributesW(FileName);
    if ( FileAttributesW == -1 )
    {
      if ( !CreateDirectoryW(FileName, 0i64) )
      {
        LastError = GetLastError();
        AbsoluteDatabasePath = LastError;
        if ( WPP_GLOBAL_Control != (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
          && (*((_BYTE *)WPP_GLOBAL_Control + 68) & 2) != 0
          && *((_BYTE *)WPP_GLOBAL_Control + 65) >= 2u )
        {
          WPP_SF_D(
            *((_QWORD *)WPP_GLOBAL_Control + 7),
            0x1Fu,
            (__int64)&WPP_10f9086a838d3f1b10076b2179e86fb4_Traceguids,
            LastError);
        }
        if ( AbsoluteDatabasePath == 183 )
          return 0;
      }
    }
    else if ( (FileAttributesW & 0x10) == 0 )
    {
      AbsoluteDatabasePath = 80;
      if ( WPP_GLOBAL_Control != (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
        && (*((_BYTE *)WPP_GLOBAL_Control + 68) & 2) != 0
        && *((_BYTE *)WPP_GLOBAL_Control + 65) >= 2u )
      {
        WPP_SF_SD(
          *((_QWORD *)WPP_GLOBAL_Control + 7),
          0x1Eu,
          (__int64)&WPP_10f9086a838d3f1b10076b2179e86fb4_Traceguids,
          FileName);
      }
    }
  }
  return AbsoluteDatabasePath;
}
// 140052CD6: variable 'a4' is possibly undefined
