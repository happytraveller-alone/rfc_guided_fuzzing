//----- (00000001400DA1C8) ----------------------------------------------------
__int64 __fastcall Xfr_BuildXfrRequest(__int64 a1, unsigned __int16 a2, int a3)
{
  CDnsClientSubnetRecordsTrie *v6; // rcx
  int v8; // ecx
  __int64 SendMessage; // rax
  __int64 v10; // rbx
  int v11; // eax

  v6 = WPP_GLOBAL_Control;
  if ( WPP_GLOBAL_Control != (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
    && (*((_BYTE *)WPP_GLOBAL_Control + 68) & 0x40) != 0
    && *((_BYTE *)WPP_GLOBAL_Control + 65) >= 4u )
  {
    WPP_SF_s(
      *((_QWORD *)WPP_GLOBAL_Control + 7),
      0x2Cu,
      (__int64)&WPP_8f5c62d9956434feed7ea8f9d17b2299_Traceguids,
      *(const char **)(a1 + 16));
    v6 = WPP_GLOBAL_Control;
  }
  if ( !*(_QWORD *)(a1 + 336) && a2 == 251 )
  {
    if ( v6 != (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
      && (*((_BYTE *)v6 + 68) & 0x40) != 0
      && *((_BYTE *)v6 + 65) >= 4u )
    {
      WPP_SF_s(
        *((_QWORD *)v6 + 7),
        0x2Du,
        (__int64)&WPP_8f5c62d9956434feed7ea8f9d17b2299_Traceguids,
        *(const char **)(a1 + 16));
    }
    return 0i64;
  }
  v8 = 0;
  if ( a3 )
    v8 = 0x10000;
  SendMessage = Msg_CreateSendMessage(v8);
  v10 = SendMessage;
  if ( !SendMessage )
    return 0i64;
  if ( !(unsigned int)Msg_WriteQuestion(SendMessage, *(__int64 **)(a1 + 56), a2) )
  {
    if ( WPP_GLOBAL_Control != (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
      && (*((_BYTE *)WPP_GLOBAL_Control + 68) & 0x40) != 0
      && *((_BYTE *)WPP_GLOBAL_Control + 65) >= 4u )
    {
      WPP_SF_Ds(
        *((_QWORD *)WPP_GLOBAL_Control + 7),
        0x2Eu,
        (__int64)&WPP_8f5c62d9956434feed7ea8f9d17b2299_Traceguids,
        a2,
        *(_QWORD *)(a1 + 16));
    }
LABEL_26:
    Packet_Free(v10);
    return 0i64;
  }
  *(_DWORD *)(v10 + 6288) |= 0x280u;
  *(_QWORD *)(v10 + 3680) = a1;
  if ( a2 == 251 )
  {
    *(_WORD *)(v10 + 1415) = 2;
    if ( (unsigned __int16)Wire_WriteRecordsAtNodeToMessage(v10, *(_QWORD *)(a1 + 40), 6u, 0i64, 12, 0, 0i64) != 1 )
    {
      if ( WPP_GLOBAL_Control != (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
        && (*((_BYTE *)WPP_GLOBAL_Control + 68) & 0x40) != 0
        && *((_BYTE *)WPP_GLOBAL_Control + 65) >= 4u )
      {
        WPP_SF_s(
          *((_QWORD *)WPP_GLOBAL_Control + 7),
          0x2Fu,
          (__int64)&WPP_8f5c62d9956434feed7ea8f9d17b2299_Traceguids,
          *(const char **)(a1 + 16));
      }
      goto LABEL_26;
    }
  }
  v11 = *(_DWORD *)(a1 + 372);
  if ( v11 == 3 && dword_1401B98F8 || v11 == 2 && *(_QWORD *)(a1 + 192) && dword_1401B99B0 )
    *(_DWORD *)(v10 + 592) |= 2u;
  if ( *(_DWORD *)(a1 + 372) == 2 )
  {
    if ( !*(_QWORD *)(a1 + 192) )
      goto LABEL_37;
    *(_QWORD *)(v10 + 6280) = a1;
  }
  if ( !*(_QWORD *)(a1 + 192) )
  {
LABEL_37:
    if ( dword_1401B98CC )
    {
      **(_WORD **)(v10 + 32) = 21325;
      *(_QWORD *)(v10 + 32) += 2i64;
    }
  }
  return v10;
}
// 1401B98CC: using guessed type int dword_1401B98CC;
// 1401B98F8: using guessed type int dword_1401B98F8;
// 1401B99B0: using guessed type int dword_1401B99B0;
