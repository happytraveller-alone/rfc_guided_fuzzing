//----- (000000014006AD8C) ----------------------------------------------------
__int64 __fastcall PQ_QueuePacketEx(__int64 a1, __int64 a2)
{
  unsigned int v4; // esi
  __int64 v5; // rdx
  __int64 v6; // r8
  unsigned int v7; // eax
  __int64 *v8; // rax
  __int64 v9; // rcx
  void *v10; // rcx

  v4 = 0;
  EnterCriticalSection((LPCRITICAL_SECTION)(a1 + 16));
  if ( *(_DWORD *)(a1 + 84) )
    PQ_DiscardExpiredQueuedPackets(a1, 1);
  if ( *(_DWORD *)(a1 + 88) )
    PQ_DiscardDuplicatesOfNewPacket(a1, a2);
  if ( WPP_GLOBAL_Control != (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
    && (*((_DWORD *)WPP_GLOBAL_Control + 17) & 0x80000) != 0
    && *((_BYTE *)WPP_GLOBAL_Control + 65) >= 4u )
  {
    WPP_SF_sqdd(*((_QWORD *)WPP_GLOBAL_Control + 7), v5, v6, *(const char **)(a1 + 56));
  }
  v7 = *(_DWORD *)(a1 + 92);
  if ( !v7 || *(_DWORD *)(a1 + 96) < v7 )
  {
    v8 = *(__int64 **)(a1 + 8);
    if ( *(_DWORD *)(a1 + 80) )
    {
      while ( v8 != (__int64 *)a1 && *((_DWORD *)v8 + 142) > *(_DWORD *)(a2 + 568) )
        v8 = (__int64 *)v8[1];
      v9 = *v8;
      if ( *(__int64 **)(*v8 + 8) != v8 )
        __fastfail(3u);
      *(_QWORD *)a2 = v9;
      *(_QWORD *)(a2 + 8) = v8;
      *(_QWORD *)(v9 + 8) = a2;
      *v8 = a2;
    }
    else
    {
      if ( *v8 != a1 )
        __fastfail(3u);
      *(_QWORD *)a2 = a1;
      *(_QWORD *)(a2 + 8) = v8;
      *v8 = a2;
      *(_QWORD *)(a1 + 8) = a2;
    }
    ++*(_DWORD *)(a1 + 100);
    v4 = 1;
    ++*(_DWORD *)(a1 + 96);
    *(_DWORD *)(a2 + 16) = *(_DWORD *)(a1 + 64);
  }
  LeaveCriticalSection((LPCRITICAL_SECTION)(a1 + 16));
  if ( v4 )
  {
    v10 = *(void **)(a1 + 72);
    if ( v10 )
      SetEvent(v10);
  }
  return v4;
}
// 14006AE15: variable 'v5' is possibly undefined
// 14006AE15: variable 'v6' is possibly undefined
// 1401B9714: using guessed type int dword_1401B9714;
