//----- (00000001400D7780) ----------------------------------------------------
__int64 __fastcall Rpc_WriteDirtyZones(__int64 a1, __int64 a2, __int64 a3, const unsigned __int16 **a4)
{
  unsigned int v5; // edi
  const wchar_t *v6; // r9
  const unsigned __int16 **NextZone; // rbx
  __int64 v8; // rdx
  __int64 v9; // r8
  int v10; // r9d

  v5 = 0;
  if ( WPP_GLOBAL_Control != (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
    && (*((_BYTE *)WPP_GLOBAL_Control + 68) & 4) != 0
    && *((_BYTE *)WPP_GLOBAL_Control + 65) >= 4u )
  {
    if ( a4 )
      v6 = *a4;
    else
      v6 = L".";
    WPP_SF_S(*((_QWORD *)WPP_GLOBAL_Control + 7), 0x80u, (__int64)&WPP_5efa35e0870730ffd13051b9da022308_Traceguids, v6);
  }
  NextZone = Zone_ListGetNextZoneEx(a4, 0i64, 0);
  if ( !NextZone )
  {
LABEL_33:
    if ( (dword_1401B9104 & 0x800) != 0 )
      TemplateEventDescriptor(Microsoft_Windows_DNSServerHandle, &DNS_EVENT_WRITE_DIRTY_ZONES);
    return v5;
  }
  do
  {
    if ( (*((_DWORD *)NextZone + 99) & 0x200) != 0 || NextZone[23] )
    {
      if ( !*((_DWORD *)NextZone + 93) )
        Zone_WriteBackRootHints(0);
      v5 = Zone_LockForRPCSeqEx((__int64)NextZone, 0x2710u);
      if ( !v5 )
      {
        if ( (*((_DWORD *)NextZone + 99) & 0x200) != 0 )
        {
          v5 = Zone_LockForWriteEx((__int64)NextZone, 1, 0x2710u, (__int64)"ds\\dns\\server\\server\\zonerpc.c", 254);
          if ( v5 )
          {
            if ( WPP_GLOBAL_Control != (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
              && (*((_BYTE *)WPP_GLOBAL_Control + 68) & 4) != 0
              && *((_BYTE *)WPP_GLOBAL_Control + 65) >= 4u )
            {
              WPP_SF_Ds(
                *((_QWORD *)WPP_GLOBAL_Control + 7),
                0x82u,
                (__int64)&WPP_5efa35e0870730ffd13051b9da022308_Traceguids,
                v5,
                (__int64)NextZone[2]);
            }
            goto LABEL_30;
          }
          Zone_GetZoneInfoFromResourceRecords((__int64)NextZone);
          if ( (*((_BYTE *)NextZone + 388) & 1) == 0
            && !(unsigned int)File_WriteZoneToFile((__int64)NextZone, 0i64, 0x10000000) )
          {
            v5 = 1013;
          }
          Zone_UnlockAfterWriteEx((__int64)NextZone, 1, (__int64)"ds\\dns\\server\\server\\zonerpc.c", 35);
          if ( *((_DWORD *)NextZone + 93) )
            Xfr_SendNotify((__int64)NextZone, v8, v9, v10);
        }
        Zone_WriteAndLoadScopes((__int64 *)NextZone, 0, 1, 1, 1);
LABEL_30:
        Lock_ReleaseWrite((__int64)NextZone[39]);
        goto LABEL_31;
      }
      if ( WPP_GLOBAL_Control != (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
        && (*((_DWORD *)WPP_GLOBAL_Control + 17) & 0x200000) != 0
        && *((_BYTE *)WPP_GLOBAL_Control + 65) >= 4u )
      {
        WPP_SF_Ds(
          *((_QWORD *)WPP_GLOBAL_Control + 7),
          0x81u,
          (__int64)&WPP_5efa35e0870730ffd13051b9da022308_Traceguids,
          v5,
          (__int64)NextZone[2]);
      }
    }
LABEL_31:
    NextZone = Zone_ListGetNextZoneEx(a4, (__int64 *)NextZone, 0);
  }
  while ( NextZone );
  if ( !v5 )
    goto LABEL_33;
  return v5;
}
// 1400D7958: variable 'v8' is possibly undefined
// 1400D7958: variable 'v9' is possibly undefined
// 1400D7958: variable 'v10' is possibly undefined
// 140187020: using guessed type EVENT_DESCRIPTOR DNS_EVENT_WRITE_DIRTY_ZONES;
// 1401B9104: using guessed type int dword_1401B9104;
