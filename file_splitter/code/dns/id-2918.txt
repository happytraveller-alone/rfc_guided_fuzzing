//----- (0000000140153640) ----------------------------------------------------
__int64 __fastcall DnsVal_ECDSA_SignatureVerificationRoutine(
        BCRYPT_ALG_HANDLE hAlgorithm,
        __int64 a2,
        __int64 a3,
        __int64 a4,
        PUCHAR pbHash,
        ULONG cbHash,
        _DWORD *a7)
{
  const void *v7; // r13
  char v8; // si
  UCHAR *pbInput; // rdi
  unsigned __int16 v12; // bx
  int v13; // ebx
  CDnsClientSubnetRecordsTrie *v14; // rcx
  unsigned __int16 v15; // dx
  int v16; // eax
  CDnsClientSubnetRecordsTrie *v17; // rcx
  unsigned __int16 v18; // dx
  ULONG v19; // r9d
  UCHAR *v20; // r8
  BCRYPT_KEY_HANDLE phKey; // [rsp+80h] [rbp+18h] BYREF

  phKey = 0i64;
  v7 = (const void *)(a3 + 60);
  v8 = *(_BYTE *)(a3 + 59);
  pbInput = 0i64;
  if ( v8 == 13 )
  {
    v12 = 64;
  }
  else
  {
    if ( v8 != 14 )
    {
      v13 = -1073741584;
      v14 = WPP_GLOBAL_Control;
      if ( WPP_GLOBAL_Control == (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
        || (*((_BYTE *)WPP_GLOBAL_Control + 28) & 1) == 0
        || *((_BYTE *)WPP_GLOBAL_Control + 25) < 4u )
      {
        return (unsigned int)v13;
      }
      v15 = 81;
      goto LABEL_32;
    }
    v12 = 96;
  }
  if ( *(unsigned __int16 *)(a3 + 14) != v12 + 4i64 )
  {
    v13 = -1073741584;
    v14 = WPP_GLOBAL_Control;
    if ( WPP_GLOBAL_Control == (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
      || (*((_BYTE *)WPP_GLOBAL_Control + 28) & 1) == 0
      || *((_BYTE *)WPP_GLOBAL_Control + 25) < 4u )
    {
      return (unsigned int)v13;
    }
    v15 = 82;
LABEL_32:
    WPP_SF_(*((_QWORD *)v14 + 2), v15, (__int64)&WPP_c53e2308f6cf3329db3757b8a77c9921_Traceguids);
    goto LABEL_33;
  }
  pbInput = (UCHAR *)Mem_Alloc((unsigned __int16)(v12 + 8), 0i64, "ds\\dns\\server\\validator\\validator.c", 2390);
  if ( !pbInput )
  {
    v13 = -1073741801;
    v14 = WPP_GLOBAL_Control;
    if ( WPP_GLOBAL_Control == (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
      || (*((_BYTE *)WPP_GLOBAL_Control + 28) & 1) == 0
      || *((_BYTE *)WPP_GLOBAL_Control + 25) < 4u )
    {
      goto LABEL_33;
    }
    v15 = 83;
    goto LABEL_32;
  }
  v16 = 861094725;
  if ( v8 == 13 )
    v16 = 827540293;
  *(_DWORD *)pbInput = v16;
  *((_DWORD *)pbInput + 1) = v12 >> 1;
  memcpy_0(pbInput + 8, v7, v12);
  v13 = BCryptImportKeyPair(hAlgorithm, 0i64, L"ECCPUBLICBLOB", &phKey, pbInput, (unsigned __int16)(v12 + 8), 0);
  if ( v13 >= 0 )
  {
    v19 = cbHash;
    v20 = pbHash;
    *a7 = 4096;
    v13 = BCryptVerifySignature(
            phKey,
            0i64,
            v20,
            v19,
            (PUCHAR)(*(unsigned __int8 *)(a4 + 74) + a4 + 76),
            (unsigned __int16)(*(_WORD *)(a4 + 14) - *(unsigned __int8 *)(a4 + 74) - 20),
            0);
    if ( v13 >= 0 )
      goto LABEL_33;
    v17 = WPP_GLOBAL_Control;
    if ( WPP_GLOBAL_Control == (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
      || (*((_BYTE *)WPP_GLOBAL_Control + 28) & 1) == 0
      || *((_BYTE *)WPP_GLOBAL_Control + 25) < 4u )
    {
      goto LABEL_33;
    }
    v18 = 85;
  }
  else
  {
    v17 = WPP_GLOBAL_Control;
    if ( WPP_GLOBAL_Control == (CDnsClientSubnetRecordsTrie *)&WPP_GLOBAL_Control
      || (*((_BYTE *)WPP_GLOBAL_Control + 28) & 1) == 0
      || *((_BYTE *)WPP_GLOBAL_Control + 25) < 4u )
    {
      goto LABEL_33;
    }
    v18 = 84;
  }
  WPP_SF_D(*((_QWORD *)v17 + 2), v18, (__int64)&WPP_c53e2308f6cf3329db3757b8a77c9921_Traceguids, v13);
LABEL_33:
  if ( phKey )
    BCryptDestroyKey(phKey);
  if ( pbInput )
    Mem_Free(pbInput, 0i64, 0i64, (__int64)"ds\\dns\\server\\validator\\validator.c", 2485);
  return (unsigned int)v13;
}
